#!perl

# Extract potentially exponential sequences
# @(#) $Id$
# 2022-04-29, Georg Fischer;
#
#:# Usage:
#:#   perl gftype1.pl $(COMMON)/bfdata.txt > output
# The biggest Perl integer is:
# 9223372036854775808
#          1        1
# 1234567890123456789
#---------------------------------
use strict;
use integer;
use warnings;

my ($aseqno, $callcode, $offset, $var, $name, @rest);
my $rseqno;
my $ofter_file = "../common/joeis_ofter.txt";
my $debug   = 0;
while (scalar(@ARGV) > 0 and ($ARGV[0] =~ m{\A[\-\+]})) {
    my $opt = shift(@ARGV);
    if (0) {
    } elsif ($opt   =~ m{\-d}  ) {
        $debug      = shift(@ARGV);
    } elsif ($opt   =~ m{\-f}  ) {
        $ofter_file = shift(@ARGV);
    } else {
        die "invalid option \"$opt\"\n";
    }
} # while $opt
#----------------
my $terms;
my %ofters = ();
open (OFT, "<", $ofter_file) || die "cannot read $ofter_file\n";
while (<OFT>) {
    s{\s+\Z}{};
    ($aseqno, $offset, $terms) = split(/\t/);
    $terms = $terms || "";
    if (defined($offset)) {
        if ($offset < -1) { # offsets -2, -3: strange, skip these
        } else {
           $ofters{$aseqno} = "$offset\t$terms";
        }
    }
} # while <OFT>
close(OFT);
print STDERR "# $0: " . scalar(%ofters) . " jOEIS offsets and some terms read from $ofter_file\n";
#----------------
while (<>) {
    s{\s+\Z}{};
    my $line = $_;
    my ($aseqno, $termno, $data) = split(/\t/, $line);
    if (defined($data)) {
        my @terms = split(/\,/, $data);
        my $ic = 9;
        if (scalar(@terms) > $ic) {
            my $cand = $terms[$ic];
            if (length($cand) <= 19 && $cand % 105 == 0 && $cand >= 5040) {
                while ($ic > 0 && $terms[$ic - 1] % 5040 == 0 && $terms[$ic - 1] >= 5040) {
                    $ic --;
                } # while
                if (! defined($ofters{$aseqno}) && $ic >= 6
                        && $terms[$ic - 1] % 720 == 0 && $terms[$ic - 1] >= 720
                        && $terms[$ic - 2] % 120 == 0 && $terms[$ic - 2] >= 120
                        && $terms[$ic - 3] %  24 == 0 && $terms[$ic - 3] >= 24
                        && $terms[$ic - 4] %   6 == 0 && $terms[$ic - 4] >= 6
                        ) {
                    print join("\t", $aseqno, "gftype", $ic - 7, $data) . "\n";
                } # defined ofters
            } # if $cand
        } # scalar > $ic
    } # defined($data)
} # while <>
#           0 1 2 3  4   5   6    7
__DATA__
A000142	43	1,1,2,6,24,120,720,5040,40320,362880,3628800,39916800,479001600,6227020800,87178291200,1307674368000,20922789888000,355687428096000,6402373705728000,121645100408832000,2432902008176640000,51090942171709440000,1124000727777607680000,25852016738884976640000,620448401733239439360000,15511210043330985984000000,403291461126605635584000000,10888869450418352160768000000,304888344611713860501504000000,8841761993739701954543616000000,265252859812191058636308480000000,8222838654177922817725562880000000,263130836933693530167218012160000000,8683317618811886495518194401280000000,295232799039604140847618609643520000000,10333147966386144929666651337523200000000,371993326789901217467999448150835200000000,13763753091226345046315979581580902400000000,523022617466601111760007224100074291200000000,20397882081197443358640281739902897356800000000,815915283247897734345611269596115894272000000000,33452526613163807108170062053440751665152000000000,1405006117752879898543142606244511569936384000000000
A333316	24	216,660,1484,1560,8208,52164,544320,592956,649800,4321800,5103210,6182220,10621380,21415680,24471720,135307008,359624088,535019100,1071782250,1113233520,1227427740,1527496740,9462748008,143935711920
A333371	37	1,4,20,132,1116,12420,171300,2884980,56674380,1289511300,34769949060,1063909626780,37255008811020,1470406699982220,63114539746598340,2936218980067393020,150241360192861037100,8497891914008911514100,514514062115556069627060,33612916136000408931463740,2349275891295028246248477780,172032832584815345527636352100,13378755901638086750397410703900,1099516160843890053152261037324660,96048746681618803676270342664408420,9030908678056465236395811466171297140,898657018298315468115046628567937294420,92682227716634029327365557124912372359820,9906131243809934610560184268959947225250180,1087486452479594704016519561462563240535217300,123116239212252586345256121822578411889325561380,15035907837552475977489569140784356954977018686220,1938649997971605939066275089487147076602448372150180,262003324875121283418489367894438074476877705486329460,36443710668241526765351045988323810171709527043877458300,5330705768655908823204291259786653447144788113431996064620,804075745684203597914904850642531174869344707698565104696660
A333372	20	1,2,2,14,110,1526,20858,388718,7614806,183489830,5561422394,174355099682,6611001621542,274364327631194,11859712864132730,562348710109678226,30121397642062848278,1792060484721674304638,109581661931207939415266,7388364108380826136619810
