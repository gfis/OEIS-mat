#!make

# OEIS-mat/data - new extraction from ../../oeisdata
# @(#) $Id$
# 2023-05-02: Georg Fischer
#---------------------------------
GITS=../..
DBAT=java -jar $(GITS)/dbat/dist/dbat-lite.jar -e UTF-8 -c worddb
DATA=$(GITS)/OEIS-mat/data
JOEIS=$(GITS)/joeis
OEISDATA=$(GITS)/oeisdata
REMOTE=atair
# set_env_var_REMOTE
#-------------
all: cat25 joeis_pull joeis_jar joeis_list joeis_ofter jcat25 pack_remote
help:
	grep -E "^[a-z]" makefile
#==============================
cat25:
	cd $(OEISDATA) ; git pull ; find seq | sort > $(DATA)/$@.list.tmp
	rm -f    $@.txt
	cd $(DATA) ; cat $(DATA)/$@.list.tmp | xargs -l -innn cat nnn >> $(DATA)/$@.txt
	head -n2 $@.txt
	wc -l    $@.txt
	ls -al   *$@.*
#----
joeis_pull: # update Sean's jOEIS repository
	cd $(JOEIS) ; git pull | tee joeis_pull.`date +%Y-%m-%d.%H`.txt
#--
joeis_jar: # rebuild the joeis.jar
	cd $(JOEIS) ; ant compile-internal jar'
#----
joeis_list: joeis_list1 joeis_list2 # get the A-numbers and used superclasses of all implemented sequences
joeis_list1:
	find $(JOEIS)/src/irvine/oeis -iname "A??????.java" \
	| xargs -l grep -HE "( extends | implements |\@author|^\/\/ Generated by )" \
	>        $@.all.tmp || :
	head -n2 $@.all.tmp 
	wc -l    $@.all.tmp 
joeis_list2:
	grep -E  "public class *A" joeis_list1.all.tmp \
	| sed -e "s/[a-zA0-9\.\/]*://" \
	| sed -e "s/public class *A/A/" \
	      -e "s/ extends / /" \
	      -e "s/ implements / /" \
	      -e "s/ *[^A-Za-z0-9 ].*//" \
	      -e "s/ /\t/" \
	| sort \
	>        joeis_list.txt
	head -n2 joeis_list.txt
	wc -l    joeis_list.txt
#--
joeis_ofter: # build a preliminary ofter file (with offset = terms = 0) for jcat25.pl
	sed -e "s/$$/\t0\t0,0,0,0,0,0,0,0$$/" joeis_aseqno.txt \
	>        $@.txt
	head -n2 $@.txt
	wc -l    $@.txt
#--
jcat25: # qualify the cat25 lines with "#" = implemented in jOEIS, "%" = nyi, "?" = conjectured
	perl $(COMMON)/jcat25.pl cat25.txt > $@.txt
	cut -b1 $@.txt | sort | uniq -c
pack_remote:
	gzip -ck cat25.txt jcat25.txt joeis_list.txt joeis_aseqno.txt > $@.gz
#--------

