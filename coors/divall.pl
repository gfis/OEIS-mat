#!perl

# Divide all terms in the input lines by a common factor
# 2020-05-27, Georg Fischer
#
#:# Usage:
#:#   perl divall.pl [-c colno] infile ... > outfile
#:#       -c    column number which contains the sequence (default 4)
#----------------
use strict;
use warnings;
use integer;

my @divs = (2,3,4,6,8,12);
my $colno = 3;
while (scalar(@ARGV) > 0 and ($ARGV[0] =~ m{\A[\-\+]})) {
    my $opt = shift(@ARGV);
    if (0) {
    } elsif ($opt =~ m{c}) {
        $colno    = shift(@ARGV);
        $colno --;
    } else {
        die "invalid option \"$opt\"\n";
    }
} # while $opt

while (<>) {
    s{\s+\Z}{}; # chompr
    next if m{\A\s*(\#.*)?\Z}; # skip empty and comment lines
    my @parms   = split(/\t/);
    my @terms   = split(/\,/, $parms[$colno]);
    my $idiv    = scalar(@divs) - 1;
    my $busy    = 1;
    my $gcd = 1;
    while ($busy == 1 and $idiv >= 0) {
        $gcd = $divs[$idiv];
        my $ok = 1;
        my $iterm = scalar(@terms) - 1; 
        while ($ok == 1 and $iterm >= 0) {
            if ($terms[$iterm] % $gcd != 0) {
                $ok = 0;
            }
            $iterm --;
        } # while iterm 
        if ($ok == 1) {
            $busy = 0;
        } else {
            $idiv --;
        }
    } # while 
    if ($busy == 1) {
        $gcd = 1;
    } else { # divide all by gcd
    	$parms[$colno] = join(",", map { $_ / $gcd } @terms);
    }
    print join("\t", "${gcd}=gcd", @parms) . "\n";
} # while <>
__DATA__
Gal.1.10.1	1	6.3.3.3.3	6,12,12,24,24,30,36,36,48,48,54,60,60,72,72,78,84,84,96,96,102,108,108,120,120,126,132,132,144,144,150,156,156,168,168,174,180,180,192,192,198,204,204,216,216,222,228,228,240,240,246,252,252,264,264,270,276,276,288,288,294,300,300,312
Gal.1.10.1	2	6.3.3.3.3	3,7,12,17,21,27,31,36,41,45,51,55,60,65,69,75,79,84,89,93,99,103,108,113,117,123,127,132,137,141,147,151,156,161,165,171,175,180,185,189,195,199,204,209,213,219,223,228,233,237,243,247,252,257,261,267,271,276,281,285,291,295,300,305
Gal.1.10.1	3	6.3.3.3.3	3,7,12,17,21,27,31,36,41,45,51,55,60,65,69,75,79,84,89,93,99,103,108,113,117,123,127,132,137,141,147,151,156,161,165,171,175,180,185,189,195,199,204,209,213,219,223,228,233,237,243,247,252,257,261,267,271,276,281,285,291,295,300,305
Gal.1.10.1	4	6.3.3.3.3	3,6,12,18,21,27,30,36,42,45,51,54,60,66,69,75,78,84,90,93,99,102,108,114,117,123,126,132,138,141,147,150,156,162,165,171,174,180,186,189,195,198,204,210,213,219,222,228,234,237,243,246,252,258,261,267,270,276,282,285,291,294,300,306
Gal.1.10.1	5	6.3.3.3.3	3,7,12,17,21,27,31,36,41,45,51,55,60,65,69,75,79,84,89,93,99,103,108,113,117,123,127,132,137,141,147,151,156,161,165,171,175,180,185,189,195,199,204,209,213,219,223,228,233,237,243,247,252,257,261,267,271,276,281,285,291,295,300,305
Gal.1.11.1	1	3.3.3.3.3.3	3,9,15,21,27,33,39,45,51,57,63,69,75,81,87,93,99,105,111,117,123,129,135,141,147,153,159,165,171,177,183,189,195,201,207,213,219,225,231,237,243,249,255,261,267,273,279,285,291,297,303,309,315,321,327,333,339,345,351,357,363,369,375,381
Gal.1.11.1	2	3.3.3.3.3.3	3,9,15,21,27,33,39,45,51,57,63,69,75,81,87,93,99,105,111,117,123,129,135,141,147,153,159,165,171,177,183,189,195,201,207,213,219,225,231,237,243,249,255,261,267,273,279,285,291,297,303,309,315,321,327,333,339,345,351,357,363,369,375,381
Gal.1.11.1	3	3.3.3.3.3.3	3,9,15,21,27,33,39,45,51,57,63,69,75,81,87,93,99,105,111,117,123,129,135,141,147,153,159,165,171,177,183,189,195,201,207,213,219,225,231,237,243,249,255,261,267,273,279,285,291,297,303,309,315,321,327,333,339,345,351,357,363,369,375,381
Gal.1.11.1	4	3.3.3.3.3.3	3,9,15,21,27,33,39,45,51,57,63,69,75,81,87,93,99,105,111,117,123,129,135,141,147,153,159,165,171,177,183,189,195,201,207,213,219,225,231,237,243,249,255,261,267,273,279,285,291,297,303,309,315,321,327,333,339,345,351,357,363,369,375,381
Gal.1.11.1	5	3.3.3.3.3.3	3,9,15,21,27,33,39,45,51,57,63,69,75,81,87,93,99,105,111,117,123,129,135,141,147,153,159,165,171,177,183,189,195,201,207,213,219,225,231,237,243,249,255,261,267,273,279,285,291,297,303,309,315,321,327,333,339,345,351,357,363,369,375,381
Gal.1.11.1	6	3.3.3.3.3.3	3,9,15,21,27,33,39,45,51,57,63,69,75,81,87,93,99,105,111,117,123,129,135,141,147,153,159,165,171,177,183,189,195,201,207,213,219,225,231,237,243,249,255,261,267,273,279,285,291,297,303,309,315,321,327,333,339,345,351,357,363,369,375,381
Gal.2.1.1	1	12.6.4	12,12,18,12,12,18,24,36,36,36,24,36,48,60,54,48,36,54,72,84,72,60,48,72,96,108,90,72,60,90,120,132,108,84,72,108,144,156,126,96,84,126,168,180,144,108,96,144,192,204,162,120,108,162,216,228,180,132,120,180,240,252,198,144
Gal.2.1.1	2	12.6.4	6,8,8,12,16,20,24,28,24,30,36,40,42,44,40,48,56,60,60,60,56,66,76,80,78,76,72,84,96,100,96,92,88,102,116,120,114,108,104,120,136,140,132,124,120,138,156,160,150,140,136,156,176,180,168,156,152,174,196,200,186,172,168,192
Gal.2.1.1	3	12.6.4	4,5,8,10,13,18,22,23,26,28,31,38,42,41,42,44,49,58,62,59,58,60,67,78,82,77,74,76,85,98,102,95,90,92,103,118,122,113,106,108,121,138,142,131,122,124,139,158,162,149,138,140,157,178,182,167,154,156,175,198,202,185,170,172
Gal.2.1.2	1	6.4.3.4	6,8,8,12,16,20,24,28,24,30,36,40,42,44,40,48,56,60,60,60,56,66,76,80,78,76,72,84,96,100,96,92,88,102,116,120,114,108,104,120,136,140,132,124,120,138,156,160,150,140,136,156,176,180,168,156,152,174,196,200,186,172,168,192
Gal.2.1.2	2	6.4.3.4	4,5,8,10,13,18,22,23,26,28,31,38,42,41,42,44,49,58,62,59,58,60,67,78,82,77,74,76,85,98,102,95,90,92,103,118,122,113,106,108,121,138,142,131,122,124,139,158,162,149,138,140,157,178,182,167,154,156,175,198,202,185,170,172
Gal.2.1.2	3	6.4.3.4	3,6,6,9,12,18,24,24,21,24,30,39,45,42,36,39,48,60,66,60,51,54,66,81,87,78,66,69,84,102,108,96,81,84,102,123,129,114,96,99,120,144,150,132,111,114,138,165,171,150,126,129,156,186,192,168,141,144,174,207,213,186,156,159
Gal.2.1.2	4	6.4.3.4	4,5,8,10,13,18,22,23,26,28,31,38,42,41,42,44,49,58,62,59,58,60,67,78,82,77,74,76,85,98,102,95,90,92,103,118,122,113,106,108,121,138,142,131,122,124,139,158,162,149,138,140,157,178,182,167,154,156,175,198,202,185,170,172
Gal.2.2.1	1	12.12.3	12,8,12,8,16,32,16,20,28,40,32,32,32,52,44,40,48,64,48,52,60,72,64,64,64,84,76,72,80,96,80,84,92,104,96,96,96,116,108,104,112,128,112,116,124,136,128,128,128,148,140,136,144,160,144,148,156,168,160,160,160,180,172,168
Gal.2.2.1	2	12.12.3	12,8,12,8,16,32,16,20,28,40,32,32,32,52,44,40,48,64,48,52,60,72,64,64,64,84,76,72,80,96,80,84,92,104,96,96,96,116,108,104,112,128,112,116,124,136,128,128,128,148,140,136,144,160,144,148,156,168,160,160,160,180,172,168
Gal.2.2.1	3	12.12.3	3,5,5,9,13,15,17,19,23,27,27,29,35,37,37,41,45,47,49,51,55,59,59,61,67,69,69,73,77,79,81,83,87,91,91,93,99,101,101,105,109,111,113,115,119,123,123,125,131,133,133,137,141,143,145,147,151,155,155,157,163,165,165,169
Gal.2.2.2	1	12.3.4.3	12,8,12,8,16,32,16,20,28,40,32,32,32,52,44,40,48,64,48,52,60,72,64,64,64,84,76,72,80,96,80,84,92,104,96,96,96,116,108,104,112,128,112,116,124,136,128,128,128,148,140,136,144,160,144,148,156,168,160,160,160,180,172,168
Gal.2.2.2	2	12.3.4.3	3,5,5,9,13,15,17,19,23,27,27,29,35,37,37,41,45,47,49,51,55,59,59,61,67,69,69,73,77,79,81,83,87,91,91,93,99,101,101,105,109,111,113,115,119,123,123,125,131,133,133,137,141,143,145,147,151,155,155,157,163,165,165,169
Gal.2.2.2	3	12.3.4.3	4,4,4,8,16,12,16,20,24,28,28,24,36,40,36,40,48,44,48,52,56,60,60,56,68,72,68,72,80,76,80,84,88,92,92,88,100,104,100,104,112,108,112,116,120,124,124,120,132,136,132,136,144,140,144,148,152,156,156,152,164,168,164,168
Gal.2.2.2	4	12.3.4.3	3,5,5,9,13,15,17,19,23,27,27,29,35,37,37,41,45,47,49,51,55,59,59,61,67,69,69,73,77,79,81,83,87,91,91,93,99,101,101,105,109,111,113,115,119,123,123,125,131,133,133,137,141,143,145,147,151,155,155,157,163,165,165,169
